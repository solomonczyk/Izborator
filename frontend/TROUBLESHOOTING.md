# üîç Troubleshooting Guide

## –û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### "The message port closed before a response was received" (content.js)

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!** –≠—Ç–∞ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∏, –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∏ —Ä–µ–∫–ª–∞–º—ã) –∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:** –ú–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab –≤ DevTools

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Network**
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
4. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/v1/...`
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –∑–∞–ø—Ä–æ—Å–∞ - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `http://localhost:3002`

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:**
```
GET http://localhost:3002/api/v1/products/browse?...
```

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:**
```
GET http://localhost:8081/api/v1/products/browse?...
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞

–í Network tab –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- **Status:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `200 OK` (–∏–ª–∏ `404` –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)
- **Response:** –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å JSON –¥–∞–Ω–Ω—ã–µ

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```javascript
console.log(process.env.NEXT_PUBLIC_API_BASE)
```

–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏: `http://localhost:3002`

---

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: "fetch failed" –∏–ª–∏ "Connection refused"

**–ü—Ä–∏—á–∏–Ω–∞:** Backend API –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Backend API –∑–∞–ø—É—â–µ–Ω:
   ```powershell
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
   Get-NetTCPConnection -LocalPort 3002
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint:
   ```powershell
   Invoke-WebRequest -Uri "http://localhost:3002/api/health" -Method GET
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞—Ç–∞–ª–æ–≥ –ø—É—Å—Ç–æ–π, –Ω–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫

**–ü—Ä–∏—á–∏–Ω–∞:** –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
   ```sql
   SELECT COUNT(*) FROM products;
   ```
2. –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞—Ä—Å–∏–Ω–≥:
   ```powershell
   cd backend
   go run cmd/worker/main.go -process
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞—Ç–µ–≥–æ—Ä–∏–∏/–≥–æ—Ä–æ–¥–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** API endpoint –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –Ω–∞–ø—Ä—è–º—É—é:
   ```powershell
   # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
   Invoke-WebRequest -Uri "http://localhost:3002/api/v1/categories/tree?lang=sr" -Method GET
   
   # –ì–æ—Ä–æ–¥–∞
   Invoke-WebRequest -Uri "http://localhost:3002/api/v1/cities?lang=sr" -Method GET
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Backend API –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –ø–æ—Ä—Ç (8081)

**–ü—Ä–∏—á–∏–Ω–∞:** –ö—ç—à Next.js –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (Ctrl+C)
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à:
   ```powershell
   Remove-Item -Recurse -Force .next
   ```
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
   ```powershell
   $env:NEXT_PUBLIC_API_BASE="http://localhost:3002"
   $env:PORT="3003"
   npm run dev
   ```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 1: Health Check

```powershell
Invoke-WebRequest -Uri "http://localhost:3002/api/health" -Method GET
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{"status":"ok"}
```

### –¢–µ—Å—Ç 2: –ö–∞—Ç–µ–≥–æ—Ä–∏–∏

```powershell
Invoke-WebRequest -Uri "http://localhost:3002/api/v1/categories/tree?lang=sr" -Method GET | Select-Object -ExpandProperty Content
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** JSON –º–∞—Å—Å–∏–≤ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

### –¢–µ—Å—Ç 3: –ì–æ—Ä–æ–¥–∞

```powershell
Invoke-WebRequest -Uri "http://localhost:3002/api/v1/cities?lang=sr" -Method GET | Select-Object -ExpandProperty Content
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** JSON –º–∞—Å—Å–∏–≤ —Å –≥–æ—Ä–æ–¥–∞–º–∏

### –¢–µ—Å—Ç 4: –ö–∞—Ç–∞–ª–æ–≥

```powershell
Invoke-WebRequest -Uri "http://localhost:3002/api/v1/products/browse?page=1&per_page=10" -Method GET | Select-Object -ExpandProperty Content
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** JSON —Å —Ç–æ–≤–∞—Ä–∞–º–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)

---

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### Backend API –ª–æ–≥–∏

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω Backend API, –≤—ã –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å:
```
{"level":"info","message":"HTTP request","method":"GET","path":"/api/v1/products/browse","status":200}
```

### Frontend –ª–æ–≥–∏

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ù–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ —Å –∫—Ä–∞—Å–Ω—ã–º —Ñ–æ–Ω–æ–º
- Network tab –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (—Å—Ç–∞—Ç—É—Å 200)

---

## –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. **–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:**
   - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Backend API (Ctrl+C)
   - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Frontend (Ctrl+C)
   - –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à Next.js: `Remove-Item -Recurse -Force frontend/.next`
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ Backend API –∑–∞–Ω–æ–≤–æ
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ Frontend –∑–∞–Ω–æ–≤–æ

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç—ã:**
   ```powershell
   # Backend –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ 3002
   Get-NetTCPConnection -LocalPort 3002
   
   # Frontend –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ 3003
   Get-NetTCPConnection -LocalPort 3003
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Docker:**
   ```powershell
   docker-compose ps
   ```
   –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `Up`

