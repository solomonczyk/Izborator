# üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Worker (–î–µ–º–æ–Ω–∞) –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å Worker

```bash
ssh root@152.53.227.37
cd ~/Izborator

# –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ worker –∑–∞–ø—É—â–µ–Ω
docker-compose ps | grep worker
```

–î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç–∞—Ç—É—Å `Up`.

## –®–∞–≥ 2: –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ Worker

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤
docker-compose logs --tail=50 worker

# –ò–ª–∏ —Å–ª–µ–¥–∏ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f worker
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**

### ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:
- `üöÄ Starting Worker Daemon...` - –¥–µ–º–æ–Ω –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
- `üïµÔ∏è Checking for outdated prices...` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ü–µ–Ω—ã
- `üîÑ Processor tick` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
- `üï∑Ô∏è Monitoring scrape started` - –Ω–∞—á–∞–ª —Å–∫—Ä–∞–ø–∏–Ω–≥
- `Scraped successfully` - —É—Å–ø–µ—à–Ω–æ —Å–ø–∞—Ä—Å–∏–ª —Ç–æ–≤–∞—Ä
- `Processed items` - –æ–±—Ä–∞–±–æ—Ç–∞–ª —Ç–æ–≤–∞—Ä—ã

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:
- `Failed to get urls for rescrape` - –Ω–µ—Ç URL –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `no raw products to process` - –Ω–µ—Ç —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `Reindex failed` - –æ—à–∏–±–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –¢–∏—à–∏–Ω–∞ (–Ω–µ—Ç –ª–æ–≥–æ–≤) - –¥–µ–º–æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

## –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
docker exec -it izborator_postgres psql -U postgres -d izborator

# –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ —Ç–æ–≤–∞—Ä—ã
SELECT COUNT(*) FROM products;

# –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ü–µ–Ω—ã
SELECT COUNT(*) FROM product_prices 
WHERE updated_at < NOW() - INTERVAL '24 hours';

# –í—ã–π–¥–∏ –∏–∑ psql
\q
```

## –®–∞–≥ 4: –ï—Å–ª–∏ Worker –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ Worker

```bash
cd ~/Izborator
docker-compose restart worker
docker-compose logs -f worker
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
# –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker exec izborator_worker env | grep -E "(DB_|MEILI|REDIS)"
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ó–∞–ø—É—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–µ—Å—Ç–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏ –¥–µ–º–æ–Ω
docker-compose stop worker

# –ó–∞–ø—É—Å—Ç–∏ worker –≤—Ä—É—á–Ω—É—é —Å —Ñ–ª–∞–≥–æ–º -daemon
docker-compose run --rm worker ./worker -daemon
```

## –®–∞–≥ 5: –î–æ–±–∞–≤—å —Ç–µ—Å—Ç–æ–≤—ã–µ URL –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞

–ï—Å–ª–∏ –≤ –±–∞–∑–µ –Ω–µ—Ç URL –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö –≤—Ä—É—á–Ω—É—é:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –±–∞–∑–µ
docker exec -it izborator_postgres psql -U postgres -d izborator

# –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ –º–∞–≥–∞–∑–∏–Ω—ã
SELECT id, name FROM shops;

# –ï—Å–ª–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –Ω–µ—Ç, –¥–æ–±–∞–≤—å –∏—Ö (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–∑ seed)
# –ó–∞—Ç–µ–º –¥–æ–±–∞–≤—å —Ç–µ—Å—Ç–æ–≤—ã–µ URL –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```

## –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä—å Meilisearch –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é

```bash
# –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ç–æ–≤–∞—Ä—ã –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
curl http://localhost:7700/indexes/products/search -H "X-Meili-API-Key: masterKey123" \
  -d '{"q": "", "limit": 5}'
```

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

–ï—Å–ª–∏ worker —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö:
1. –î–æ–±–∞–≤—å —Ç–µ—Å—Ç–æ–≤—ã–µ URL –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
2. –ó–∞–ø—É—Å—Ç–∏ —Ä—É—á–Ω–æ–π —Å–∫—Ä–∞–ø–∏–Ω–≥ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
3. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –±–∞–∑—É
4. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ Meilisearch –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã

–ï—Å–ª–∏ worker –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î/Meilisearch/Redis
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ worker
4. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è - –ø—Ä–æ–≤–µ—Ä—å –∫–æ–¥ worker

