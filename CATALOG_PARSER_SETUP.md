# ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–µ—Ä –∫–∞—Ç–∞–ª–æ–≥–æ–≤, –∫–æ—Ç–æ—Ä—ã–π:
1. **–û–±—Ö–æ–¥–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ç–∞–ª–æ–≥–∞** –º–∞–≥–∞–∑–∏–Ω–∞
2. **–ù–∞—Ö–æ–¥–∏—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑—É** –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
4. **–†–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç (–≤–º–µ—Å—Ç–µ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ü–µ–Ω)

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Worker —Ç–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

1. **–ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥:**
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–æ–≤ (`Processor tick`)

2. **–ö–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç:**
   - üîç **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤** (`Catalog Discovery`) - –æ–±—Ö–æ–¥–∏—Ç –∫–∞—Ç–∞–ª–æ–≥ –∏ –Ω–∞—Ö–æ–¥–∏—Ç –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã
   - üïµÔ∏è **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω** (`Monitoring`) - –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
   - üîç **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è** (`Reindex`) - –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–∏—Å–∫–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Gigatron

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
ssh root@152.53.227.37
cd ~/Izborator

# –í—ã–ø–æ–ª–Ω–∏ SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker exec -i izborator_postgres psql -U postgres -d izborator < backend/scripts/update_gigatron_catalog.sql
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
docker exec -it izborator_postgres psql -U postgres -d izborator
```

–ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏:

```sql
UPDATE shops
SET selectors = selectors || '{
    "catalog_url": "https://gigatron.rs/mobilni-telefoni",
    "catalog_product_link": ".product-box a, .product-item a, .product-title a",
    "catalog_next_page": ".pagination .next, .pagination-next"
}'::jsonb
WHERE id = 'a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11';
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ worker

```bash
cd ~/Izborator
docker-compose restart worker

# –°–ª–µ–¥–∏ –∑–∞ –ª–æ–≥–∞–º–∏
docker-compose logs -f worker
```

## –ß—Ç–æ —É–≤–∏–¥–∏—à—å –≤ –ª–æ–≥–∞—Ö

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –≤ –ª–æ–≥–∞—Ö worker –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:

```
üîç Starting catalog discovery...
Discovering products from catalog (shop: Gigatron, catalog_url: https://gigatron.rs/mobilni-telefoni)
Parsing catalog page (url: ..., page: 1, found_so_far: 0)
Found products in catalog (shop: Gigatron, total_found: 24)
‚úÖ Catalog discovery completed (shop: Gigatron, found: 24, saved: 24)
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥—Ä—É–≥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞:

1. **–î–æ–±–∞–≤—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**

```sql
UPDATE shops
SET selectors = selectors || '{
    "catalog_url": "https://–º–∞–≥–∞–∑–∏–Ω.rs/–∫–∞—Ç–µ–≥–æ—Ä–∏—è",
    "catalog_product_link": ".—Å–µ–ª–µ–∫—Ç–æ—Ä-—Ç–æ–≤–∞—Ä–∞ a",
    "catalog_next_page": ".—Å–µ–ª–µ–∫—Ç–æ—Ä-—Å–ª–µ–¥—É—é—â–µ–π-—Å—Ç—Ä–∞–Ω–∏—Ü—ã"
}'::jsonb
WHERE id = 'ID_–ú–ê–ì–ê–ó–ò–ù–ê';
```

2. **–°–µ–ª–µ–∫—Ç–æ—Ä—ã:**
   - `catalog_url` - –Ω–∞—á–∞–ª—å–Ω—ã–π URL –∫–∞—Ç–∞–ª–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/mobilni-telefoni`)
   - `catalog_product_link` - CSS —Å–µ–ª–µ–∫—Ç–æ—Ä —Å—Å—ã–ª–æ–∫ –Ω–∞ —Ç–æ–≤–∞—Ä—ã
   - `catalog_next_page` - CSS —Å–µ–ª–µ–∫—Ç–æ—Ä —Å—Å—ã–ª–∫–∏ "–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ worker
docker-compose logs --tail=50 worker | grep -E "(catalog|discovery|Found products)"

# –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ç–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–∏–ª–∏—Å—å
docker exec izborator_postgres psql -U postgres -d izborator -c \
  "SELECT COUNT(*) FROM raw_products WHERE shop_id = 'a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11';"
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–∞—Ç–∞–ª–æ–≥ –ø–∞—Ä—Å–∏—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç. –ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å:

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `backend/cmd/worker/main.go`:

```go
// –ò–∑–º–µ–Ω–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ 1 —á–∞—Å)
scrapeTicker := time.NewTicker(1 * time.Hour)
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–∞—Ä—Å–∏—Ç—Å—è **–º–∞–∫—Å–∏–º—É–º 3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã** –∑–∞ —Ä–∞–∑ (—á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω)
- –ú–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –µ—Å—Ç—å –ø–∞—É–∑–∞ (rate limiting –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –º–∞–≥–∞–∑–∏–Ω–∞)
- Worker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ URL —Ç–æ–≤–∞—Ä–æ–º –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π

## –ì–æ—Ç–æ–≤–æ! üéâ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ worker –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ù–∞—Ö–æ–¥–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
- –ü–∞—Ä—Å–∏—Ç—å –∏—Ö —Ü–µ–Ω—ã –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- –û–±–Ω–æ–≤–ª—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã
- –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤ Meilisearch

**–ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏!** üöÄ

