# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
ssh root@152.53.227.37
cd ~/Izborator
docker-compose ps
```

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `Up` –∏ `healthy`.

### 2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Nginx

```bash
docker logs izborator_nginx --tail 50
```

–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ "SSL certificate not found" –∏–ª–∏ "permission denied".

### 3. –ü—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker exec izborator_nginx ls -la /etc/letsencrypt/live/152.53.227.37.nip.io/
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–∞–π–ª—ã:
- `fullchain.pem`
- `privkey.pem`

### 4. –ü—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑ curl

```bash
# –ü—Ä–æ–≤–µ—Ä—å HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç
curl -I http://152.53.227.37.nip.io

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: HTTP/1.1 301 Moved Permanently
# Location: https://152.53.227.37.nip.io/...

# –ü—Ä–æ–≤–µ—Ä—å HTTPS
curl -I https://152.53.227.37.nip.io/api/health

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: HTTP/1.1 200 OK
# –ë–µ–∑ –æ—à–∏–±–æ–∫ SSL
```

### 5. –ü—Ä–æ–≤–µ—Ä—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- `https://152.53.227.37.nip.io`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ó–µ–ª–µ–Ω—ã–π –∑–∞–º–æ—á–µ–∫ üîí (–≤–∞–ª–∏–¥–Ω—ã–π SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç)
- ‚úÖ –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –°–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ö–∞—Ç–∞–ª–æ–≥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –û—à–∏–±–∫–∞: "SSL certificate not found"

```bash
# –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –Ω–∞ —Ö–æ—Å—Ç–µ
ls -la /etc/letsencrypt/live/152.53.227.37.nip.io/

# –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
chmod 644 /etc/letsencrypt/live/152.53.227.37.nip.io/fullchain.pem
chmod 600 /etc/letsencrypt/live/152.53.227.37.nip.io/privkey.pem

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ Nginx
docker restart izborator_nginx
```

### –û—à–∏–±–∫–∞: "Permission denied"

```bash
# –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ volume –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
docker inspect izborator_nginx | grep -A 10 Mounts

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
cd ~/Izborator
docker-compose up -d --force-recreate nginx
```

### –û—à–∏–±–∫–∞: "Certificate expired" –∏–ª–∏ "Self-signed certificate"

```bash
# –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
curl -v https://152.53.227.37.nip.io 2>&1 | grep -i certificate

# –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥ Nginx
docker exec izborator_nginx cat /etc/nginx/nginx.conf | grep ssl_certificate
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

Certbot —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–∏–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å:

```bash
# –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ timer –∞–∫—Ç–∏–≤–µ–Ω
systemctl list-timers | grep certbot

# –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å cron
crontab -l | grep certbot
```

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 60 –¥–Ω–µ–π.

## –ì–æ—Ç–æ–≤–æ! üéâ

–ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ, —Ç–≤–æ–π —Å–∞–π—Ç —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤–∞–ª–∏–¥–Ω—ã–º HTTPS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º!

