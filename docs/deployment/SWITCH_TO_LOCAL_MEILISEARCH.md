# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π Meilisearch

## ‚ö†Ô∏è –°–†–û–ß–ù–û: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å –æ–±–ª–∞—á–Ω–æ–≥–æ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π Meilisearch

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è —Å –ø–ª–∞—Ç–Ω–æ–≥–æ –æ–±–ª–∞—á–Ω–æ–≥–æ Meilisearch –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

---

## –®–∞–≥ 0: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

**–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH:**

```bash
ssh root@152.53.227.37
```

**–ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å SSH –∫–ª—é—á:**

```bash
ssh -i ~/.ssh/your_key root@152.53.227.37
```

**–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–µ—Ä–µ–π–¥–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞:**

```bash
# –ü—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ /root/Izborator (—Å –±–æ–ª—å—à–æ–π –±—É–∫–≤—ã I)
cd /root/Izborator

# –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ç—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
ls -la | grep docker-compose.yml
```

---

## –®–∞–≥ –ê: –ü—Ä–æ–≤–µ—Ä–∫–∞ docker-compose.yml

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏:**

```bash
nano docker-compose.yml
```

**–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –±–ª–æ–∫ `meilisearch` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω:**

```yaml
  # 2. –ü–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ (Fast Search)
  meilisearch:
    image: getmeili/meilisearch:v1.3
    container_name: izborator_meilisearch
    restart: always
    environment:
      MEILI_MASTER_KEY: ${MEILISEARCH_API_KEY}
      MEILI_ENV: ${ENV:-development}
    ports:
      - "7700:7700"
    volumes:
      - meili_data:/meili_data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7700/health"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - izborator_network
```

‚úÖ **–ï—Å–ª–∏ –±–ª–æ–∫ –µ—Å—Ç—å –∏ –Ω–µ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω** ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ –®–∞–≥—É –ë.

‚ùå **–ï—Å–ª–∏ –±–ª–æ–∫–∞ –Ω–µ—Ç –∏–ª–∏ –æ–Ω –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω** ‚Äî —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π –∏–ª–∏ –¥–æ–±–∞–≤—å –µ–≥–æ.

---

## –®–∞–≥ –ë: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ—Ç–∫—Ä–æ–π —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:**

```bash
nano .env
```

**–ù–∞–π–¥–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `MEILISEARCH_HOST` –∏ `MEILISEARCH_API_KEY`.**

### ‚ùå –ï—Å–ª–∏ —Ç–∞–º —É–∫–∞–∑–∞–Ω –æ–±–ª–∞—á–Ω—ã–π —Ö–æ—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä):
```env
MEILISEARCH_HOST=https://xxx-xxx-xxx.meilisearch.cloud
MEILISEARCH_API_KEY=cloud_api_key_here
```

### ‚úÖ –ó–∞–º–µ–Ω–∏ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```env
MEILISEARCH_HOST=meilisearch
MEILISEARCH_PORT=7700
MEILISEARCH_API_KEY=your_local_master_key_here
```

**–í–∞–∂–Ω–æ:**
- `MEILISEARCH_HOST=meilisearch` ‚Äî —ç—Ç–æ –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –≤ Docker —Å–µ—Ç–∏ (–Ω–µ `localhost`!)
- `MEILISEARCH_PORT=7700` ‚Äî –ø–æ—Ä—Ç –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- `MEILISEARCH_API_KEY` ‚Äî –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `MEILI_MASTER_KEY` –≤ docker-compose.yml

**–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–µ—Ç** ‚Äî –¥–æ–±–∞–≤—å –∏—Ö –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ `.env`.

---

## –®–∞–≥ –í: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ API –∫–ª—é—á–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–ª—é—á:**

```bash
openssl rand -base64 32
```

**–°–∫–æ–ø–∏—Ä—É–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ –¥–ª—è:**
1. `MEILISEARCH_API_KEY` –≤ `.env`
2. `MEILI_MASTER_KEY` –≤ `docker-compose.yml` (–∏–ª–∏ –æ—Å—Ç–∞–≤—å `${MEILISEARCH_API_KEY}`)

---

## –®–∞–≥ –ì: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose down

# –ó–∞–ø—É—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ (—ç—Ç–æ —Å–æ–∑–¥–∞—Å—Ç/–ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç meilisearch –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ meilisearch –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ meilisearch
docker-compose logs meilisearch
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `izborator_meilisearch` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `Up`
- –í –ª–æ–≥–∞—Ö –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## –®–∞–≥ –î: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ backend –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É Meilisearch:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ backend
docker-compose logs backend | grep -i meilisearch

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
# "Meilisearch connection established" status="available"
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—à—å –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `izborator_meilisearch` –∑–∞–ø—É—â–µ–Ω: `docker-compose ps`
2. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –æ–Ω–∏ –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏: `docker network inspect izborator_izborator_network`
3. –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ backend: `docker-compose exec backend env | grep MEILISEARCH`

---

## –®–∞–≥ –ï: –†–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–ï—Å–ª–∏ —É —Ç–µ–±—è —É–∂–µ –±—ã–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –æ–±–ª–∞—á–Ω–æ–º Meilisearch, –∏—Ö –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏–ª–∏ —Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å:**

```bash
# –ó–∞–ø—É—Å—Ç–∏ —Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é —á–µ—Ä–µ–∑ worker
docker-compose exec worker ./worker -reindex

# –ò–ª–∏ —á–µ—Ä–µ–∑ API (–µ—Å–ª–∏ –µ—Å—Ç—å endpoint)
curl -X POST http://localhost/api/v1/admin/reindex
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

- [ ] –ë–ª–æ–∫ `meilisearch` –µ—Å—Ç—å –≤ `docker-compose.yml` –∏ –Ω–µ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] –í `.env` —Ñ–∞–π–ª–µ `MEILISEARCH_HOST=meilisearch` (–Ω–µ –æ–±–ª–∞—á–Ω—ã–π URL)
- [ ] –í `.env` —Ñ–∞–π–ª–µ `MEILISEARCH_PORT=7700`
- [ ] `MEILISEARCH_API_KEY` –≤ `.env` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `MEILI_MASTER_KEY` –≤ docker-compose.yml
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `izborator_meilisearch` –∑–∞–ø—É—â–µ–Ω: `docker-compose ps`
- [ ] Backend —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è (–ø—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏)
- [ ] –î–∞–Ω–Ω—ã–µ —Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

**–ü—Ä–æ–±–ª–µ–º–∞: Backend –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Meilisearch**

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏: `docker network ls`
2. –ü—Ä–æ–≤–µ—Ä—å DNS —Ä–µ–∑–æ–ª—é—Ü–∏—é: `docker-compose exec backend ping meilisearch`
3. –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `docker-compose exec backend env | grep MEILISEARCH`

**–ü—Ä–æ–±–ª–µ–º–∞: Meilisearch –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `docker-compose logs meilisearch`
2. –ü—Ä–æ–≤–µ—Ä—å, –Ω–µ –∑–∞–Ω—è—Ç –ª–∏ –ø–æ—Ä—Ç 7700: `netstat -tuln | grep 7700`
3. –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞ –Ω–∞ volume: `docker volume inspect izborator_meili_data`

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–í Docker Compose** –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `MEILISEARCH_HOST` –∏ `MEILISEARCH_PORT` –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω—ã –≤ —Å–µ–∫—Ü–∏—è—Ö `environment` –¥–ª—è `backend` –∏ `worker`, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π Meilisearch –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- **–ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å `.env` —Ñ–∞–π–ª** —Å –æ–±–ª–∞—á–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏, –æ–Ω –º–æ–∂–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ `MEILISEARCH_API_KEY`, –Ω–æ –Ω–µ `MEILISEARCH_HOST` –∏ `MEILISEARCH_PORT` (–æ–Ω–∏ –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω—ã –≤ docker-compose.yml).
- **–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏** –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–ª–∞—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

---

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 5-10 –º–∏–Ω—É—Ç**

**–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª–æ–∫–∞–ª—å–Ω—ã–º Meilisearch –±–µ–∑ –ø–ª–∞—Ç–Ω—ã—Ö –æ–±–ª–∞—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.**

