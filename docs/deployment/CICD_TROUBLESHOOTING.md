# üîß Troubleshooting GitHub Actions CI/CD

## –û—à–∏–±–∫–∞: "The ssh-private-key argument is empty"

### –ü—Ä–∏—á–∏–Ω–∞
–°–µ–∫—Ä–µ—Ç `SSH_PRIVATE_KEY` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –∏–º–µ–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è.

### –†–µ—à–µ–Ω–∏–µ

1. **–ü—Ä–æ–≤–µ—Ä—å –∏–º—è —Å–µ–∫—Ä–µ—Ç–∞:**
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ—á–Ω–æ: `SSH_PRIVATE_KEY` (–∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏)
   - –ù–µ `ssh_private_key`, –Ω–µ `SSH_PRIVATE_KEY_1`, –Ω–µ –¥—Ä—É–≥–æ–µ –∏–º—è

2. **–ü—Ä–æ–≤–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–µ–∫—Ä–µ—Ç–∞:**
   ```bash
   # –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
   cat ~/.ssh/github_actions
   ```
   
   –î–æ–ª–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å:
   ```
   -----BEGIN OPENSSH PRIVATE KEY-----
   ```
   
   –ò –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è:
   ```
   -----END OPENSSH PRIVATE KEY-----
   ```

3. **–ü–µ—Ä–µ—Å–æ–∑–¥–∞–π —Å–µ–∫—Ä–µ—Ç:**
   - GitHub ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
   - –ù–∞–π–¥–∏ `SSH_PRIVATE_KEY`
   - –£–¥–∞–ª–∏ –µ–≥–æ
   - –°–æ–∑–¥–∞–π –∑–∞–Ω–æ–≤–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º –∏ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º

4. **–ü—Ä–æ–≤–µ—Ä—å —Ñ–æ—Ä–º–∞—Ç:**
   - –ö–æ–ø–∏—Ä—É–π –∫–ª—é—á –ø–æ–ª–Ω–æ—Å—Ç—å—é (Ctrl+A, Ctrl+C)
   - –í—Å—Ç–∞–≤–ª—è–π –≤ GitHub –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
   - –ù–µ –¥–æ–±–∞–≤–ª—è–π –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –≤—Ä—É—á–Ω—É—é

## –û—à–∏–±–∫–∞: "Permission denied (publickey)"

### –ü—Ä–∏—á–∏–Ω–∞
–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.

### –†–µ—à–µ–Ω–∏–µ

1. **–î–æ–±–∞–≤—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   ssh-copy-id -i ~/.ssh/github_actions.pub root@152.53.227.37
   ```

2. **–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:**
   ```bash
   cat ~/.ssh/github_actions.pub | ssh root@152.53.227.37 "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   ssh root@152.53.227.37
   chmod 700 ~/.ssh
   chmod 600 ~/.ssh/authorized_keys
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
   ```bash
   ssh -i ~/.ssh/github_actions root@152.53.227.37
   ```
   
   –î–æ–ª–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –±–µ–∑ –ø–∞—Ä–æ–ª—è.

## –û—à–∏–±–∫–∞: "Connection refused" –∏–ª–∏ "Connection timed out"

### –ü—Ä–∏—á–∏–Ω–∞
–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.

### –†–µ—à–µ–Ω–∏–µ

1. **–ü—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞:**
   ```bash
   ping 152.53.227.37
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   ssh root@152.53.227.37
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å firewall:**
   ```bash
   # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
   ufw status
   # –∏–ª–∏
   iptables -L
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ SSH —Å–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 22:**
   ```bash
   # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
   netstat -tlnp | grep :22
   ```

## –û—à–∏–±–∫–∞: "Host key verification failed"

### –ü—Ä–∏—á–∏–Ω–∞
–°–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ known_hosts.

### –†–µ—à–µ–Ω–∏–µ

Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä –≤ known_hosts. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å SERVER_HOST –≤ Secrets:**
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `152.53.227.37`
   - –ë–µ–∑ `http://`, –±–µ–∑ `https://`, –±–µ–∑ –ø–æ—Ä—Ç–∞

2. **–î–æ–±–∞–≤—å —Å–µ—Ä–≤–µ—Ä –≤ known_hosts –≤—Ä—É—á–Ω—É—é (–≤ workflow):**
   –£–∂–µ –µ—Å—Ç—å –≤ workflow, –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
   ```yaml
   - name: Add server to known hosts
     run: |
       ssh-keyscan -H ${{ secrets.SERVER_HOST }} >> ~/.ssh/known_hosts
   ```

## –û—à–∏–±–∫–∞: "git pull failed" –∏–ª–∏ "docker-compose failed"

### –ü—Ä–∏—á–∏–Ω–∞
–ü—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥.

### –†–µ—à–µ–Ω–∏–µ

1. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –≤ GitHub Actions:**
   - –û—Ç–∫—Ä–æ–π failed workflow
   - –°–º–æ—Ç—Ä–∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ —à–∞–≥–∞ "Deploy to server"

2. **–ü—Ä–æ–≤–µ—Ä—å –≤—Ä—É—á–Ω—É—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   ssh root@152.53.227.37
   cd ~/Izborator
   git pull
   docker-compose ps
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   ```bash
   # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
   ls -la ~/Izborator
   ```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º:

- [ ] SSH –∫–ª—é—á —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: `~/.ssh/github_actions`
- [ ] –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä: `ssh-copy-id -i ~/.ssh/github_actions.pub root@152.53.227.37`
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: `ssh -i ~/.ssh/github_actions root@152.53.227.37`
- [ ] –°–µ–∫—Ä–µ—Ç `SSH_PRIVATE_KEY` –¥–æ–±–∞–≤–ª–µ–Ω –≤ GitHub (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è!)
- [ ] –°–µ–∫—Ä–µ—Ç `SERVER_HOST` –¥–æ–±–∞–≤–ª–µ–Ω –≤ GitHub (–∑–Ω–∞—á–µ–Ω–∏–µ: `152.53.227.37`)
- [ ] –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker –∏ Docker Compose
- [ ] –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `~/Izborator` —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –∫–ª—é—á–∞ –ª–æ–∫–∞–ª—å–Ω–æ
ssh -i ~/.ssh/github_actions -v root@152.53.227.37

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞ (–≤ GitHub Actions –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —à–∞–≥)
- name: Debug
  run: |
    echo "SSH key length: ${#SSH_PRIVATE_KEY}"
    echo "Server host: $SERVER_HOST"
  env:
    SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
    SERVER_HOST: ${{ secrets.SERVER_HOST }}
```

