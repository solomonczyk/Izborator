# ü§ñ AutoConfig Worker - –ó–∞–ø—É—Å–∫ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

## –û–ø–∏—Å–∞–Ω–∏–µ

AutoConfig Worker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç CSS-—Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—è AI (OpenAI GPT-4o-mini). –ü—Ä–æ—Ü–µ—Å—Å –≤–∫–ª—é—á–∞–µ—Ç:
1. **Scout** - –ø–æ–∏—Å–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∞–π—Ç–µ
2. **Fetch & Clean** - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –æ—á–∏—Å—Ç–∫–∞ HTML
3. **AI Generation** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ OpenAI
4. **Validation** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤
5. **Save** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ –≤ —Ç–∞–±–ª–∏—Ü—É `shops`

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- OpenAI API –∫–ª—é—á –≤ `.env`: `OPENAI_API_KEY=—Ç–≤–æ–π_–∫–ª—é—á`
- –ö–∞–Ω–¥–∏–¥–∞—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `classified` –≤ —Ç–∞–±–ª–∏—Ü–µ `potential_shops`
- –ó–∞–ø—É—â–µ–Ω–Ω–∞—è –ë–î –∏ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

## –ó–∞–ø—É—Å–∫ –≤ Docker

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞

```bash
docker-compose run --rm backend ./autoconfig
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

```bash
docker-compose run --rm backend ./autoconfig -limit 5
```

### –†–µ–∂–∏–º –¥–µ–º–æ–Ω–∞ (–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

```bash
docker-compose run --rm backend ./autoconfig -daemon -interval 10m
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `-limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1)
- `-daemon` - –∑–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –¥–µ–º–æ–Ω–∞ (–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
- `-interval` - –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏ –≤ —Ä–µ–∂–∏–º–µ –¥–µ–º–æ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5m)

## –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

1. **Scout** –∏—â–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–≤–∞—Ä –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–∞–≥–∞–∑–∏–Ω–∞
2. **Fetch** —Å–∫–∞—á–∏–≤–∞–µ—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
3. **Clean** —É–¥–∞–ª—è–µ—Ç —Å–∫—Ä–∏–ø—Ç—ã, —Å—Ç–∏–ª–∏ –∏ –º—É—Å–æ—Ä (–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É)
4. **AI** –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç HTML –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JSON —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º–∏
5. **Validate** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç –¥–∞–Ω–Ω—ã–µ (name –∏ price)
6. **Save** —Å–æ–∑–¥–∞–µ—Ç –º–∞–≥–∞–∑–∏–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ `shops` –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `configured`

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –£—Å–ø–µ—à–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `shops` —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º–∏
- –°—Ç–∞—Ç—É—Å –≤ `potential_shops` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ `configured`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–ø—ã—Ç–∫–∞ –≤ `shop_config_attempts` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `success`

### –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- –°—Ç–∞—Ç—É—Å –≤ `potential_shops` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ `rejected`
- –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ `shop_config_attempts`
- –ö–∞–Ω–¥–∏–¥–∞—Ç –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ä—É—á–Ω—É—é –ø–æ–∑–∂–µ

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```sql
-- –£—Å–ø–µ—à–Ω–æ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã
SELECT id, name, base_url, is_auto_configured, ai_config_model
FROM shops
WHERE is_auto_configured = true
ORDER BY created_at DESC;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ø—ã—Ç–∫–∞–º
SELECT status, COUNT(*) as count
FROM shop_config_attempts
GROUP BY status;

-- –ö–∞–Ω–¥–∏–¥–∞—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º configured
SELECT domain, confidence_score, classified_at
FROM potential_shops
WHERE status = 'configured'
ORDER BY classified_at DESC;
```

## Troubleshooting

### –û—à–∏–±–∫–∞: "Autoconfig service is not available"
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ `OPENAI_API_KEY` –∑–∞–¥–∞–Ω –≤ `.env`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `docker-compose restart backend`

### –û—à–∏–±–∫–∞: "401 Unauthorized: Incorrect API key provided"
**–ö–†–ò–¢–ò–ß–ù–û:** –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ OpenAI API –∫–ª—é—á –Ω–µ–≤–µ—Ä–Ω—ã–π, –∏—Å—Ç–µ–∫ –∏–ª–∏ –±—ã–ª –æ—Ç–æ–∑–≤–∞–Ω.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å –∫–ª—é—á –≤ `.env` —Ñ–∞–π–ª–µ:
   ```bash
   cat .env | grep OPENAI_API_KEY
   ```

2. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π API –∫–ª—é—á:
   - –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ https://platform.openai.com/account/api-keys
   - –ù–∞–∂–º–∏ "Create new secret key"
   - –°–∫–æ–ø–∏—Ä—É–π –Ω–æ–≤—ã–π –∫–ª—é—á

3. –û–±–Ω–æ–≤–∏ `.env` —Ñ–∞–π–ª:
   ```bash
   nano .env
   # –ò–ª–∏
   vi .env
   ```
   –ó–∞–º–µ–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏–µ `OPENAI_API_KEY` –Ω–∞ –Ω–æ–≤—ã–π –∫–ª—é—á

4. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:
   ```bash
   # –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å sk-proj- –∏–ª–∏ sk-
   # –î–ª–∏–Ω–∞ –æ–±—ã—á–Ω–æ 50+ —Å–∏–º–≤–æ–ª–æ–≤
   ```

5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ AutoConfig:
   ```bash
   ./run-autoconfig-server.sh
   ```

**–í–∞–∂–Ω–æ:** 
- –ù–µ –∫–æ–º–º–∏—Ç—å `.env` —Ñ–∞–π–ª –≤ Git (–æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `.gitignore`)
- –ï—Å–ª–∏ –∫–ª—é—á –±—ã–ª —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω - –æ—Ç–∑–æ–≤–∏ –µ–≥–æ –Ω–∞ platform.openai.com
- –ü—Ä–æ–≤–µ—Ä—å –±–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞ OpenAI (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤)

### –û—à–∏–±–∫–∞: "Scout failed"
- –°–∞–π—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –°–∞–π—Ç –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å JS –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (–Ω—É–∂–µ–Ω browser parser)
- –ü–æ–ø—Ä–æ–±—É–π –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥—Ä—É–≥–æ–π –∫–∞–Ω–¥–∏–¥–∞—Ç

### –û—à–∏–±–∫–∞: "AI generation failed"
- –ü—Ä–æ–≤–µ—Ä—å –±–∞–ª–∞–Ω—Å OpenAI API
- –ü—Ä–æ–≤–µ—Ä—å –ª–∏–º–∏—Ç—ã API (rate limits)
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –º–æ–¥–µ–ª—å `gpt-4o-mini` –¥–æ—Å—Ç—É–ø–Ω–∞

### –û—à–∏–±–∫–∞: "Validation failed"
- AI —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∞–π—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–π
- –ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –≤—Ä—É—á–Ω—É—é

## –°—Ç–æ–∏–º–æ—Å—Ç—å

- –ú–æ–¥–µ–ª—å `gpt-4o-mini`: ~$0.01 –∑–∞ –º–∞–≥–∞–∑–∏–Ω
- HTML –æ—á–∏—Å—Ç–∫–∞: –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- –í–∞–ª–∏–¥–∞—Ü–∏—è: –±–µ—Å–ø–ª–∞—Ç–Ω–æ

**–ò—Ç–æ–≥–æ:** ~$0.01 –∑–∞ —É—Å–ø–µ—à–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–∞–≥–∞–∑–∏–Ω–∞.

